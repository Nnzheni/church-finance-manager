<!DOCTYPE html>
<html><head>
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head><body class="bg-light p-4">
  <a href="{{url_for('logout')}}" class="btn btn-outline-secondary float-end">Logout</a>
  <h3>Welcome, {{user}} ({{role}})</h3>

  <!-- month/year filter -->
  <form class="row g-2 mb-4">
    <div class="col"><select name="month" class="form-select">
      {% for m in range(1,13) %}<option value="{{m}}" {%if m==month%}selected{%endif%}>{{m}}</option>{% endfor %}
    </select></div>
    <div class="col"><select name="year" class="form-select">
      {% for y in range(year-2, year+1) %}<option value="{{y}}" {%if y==year%}selected{%endif%}>{{y}}</option>{% endfor %}
    </select></div>
    <div class="col"><button class="btn btn-primary">Apply</button></div>
  </form>

  <!-- action buttons -->
  <div class="mb-4">
    <a href="{{url_for('add_income')}}"  class="btn btn-success me-2">Add Income</a>
    <a href="{{url_for('add_expense')}}" class="btn btn-danger me-2">Add Expense</a>
    <a href="{{url_for('report')}}"     class="btn btn-info">View Report</a>
  </div>

  <!-- totals & budget -->
  <div class="card mb-4">
    <div class="card-body">
      <p><strong>Income:</strong> R{{total_inc}}</p>
      <p><strong>Expense:</strong> R{{total_exp}}</p>
      <p><strong>Budget Limit:</strong> R{{limit}}</p>
      <p><strong>Remaining:</strong>
         <span class="{{'text-danger' if remain<0 else 'text-success'}}">R{{remain}}</span>
      </p>
    </div>
  </div>

  <!-- chart -->
  <canvas id="chart"></canvas>
  <script>
    new Chart(document.getElementById('chart'), {
      type:'bar',
      data:{
        labels:{{chart_labels|tojson}},
        datasets:[
          {label:'Income', data:{{chart_inc|tojson}}, backgroundColor:'rgba(40,167,69,0.7)'},
          {label:'Expense',data:{{chart_exp|tojson}},backgroundColor:'rgba(220,53,69,0.7)'}
        ]
      }
    });
  </script>
</body></html>
